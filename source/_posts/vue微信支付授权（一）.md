---
title: Vue微信支付授权的坑（当前页面的URL未注册）
date: 2019-02-11 13:45:11
categories: 
  - 微信公众号
tags: 
  - 微信 
  - vue 
  - 授权
---

## 获取微信授权的URL
微信支付之前都要获取微信授权，由于微信对 IOS 和 Android 的 URL 的处理不同，所以这里统一使用这个方法获取授权时使用的 URL
```javascript
let url = window.location.href.split('#')[0];
```

## `?` 的作用
尽管你向后台发送了被`#`截取过的授权URL，但是在真正支付的时候，你或许还是会看到 URL未注册的情况。
![支付失败](url.png)

### 解决问题
> 这个时候请大胆的在当前的页面的`#`前面拼接`?`
- 微信在检验`URL`的时候，如果`URL`字符串内有`?`,会将`?`前的所有内容全部截取
- 如果`?`出现在`#`后，会导致`#`前的内容也被截取，从而导致认证失败
- 所以这里通过提前加`?`的方式避开了认证地址截取过多的问题



